<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>Presentation</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="deck.js/core/deck.core.css">
	
	<!-- Extension CSS files go here. Remove or add as needed. -->
	<link rel="stylesheet" href="deck.js/extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="deck.js/extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="deck.js/extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="deck.js/extensions/status/deck.status.css">
	<link rel="stylesheet" href="deck.js/extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="deck.js/extensions/scale/deck.scale.css">

	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="deck.js/themes/style/swiss.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="deck.js/themes/transition/fade.css">
  <style type="text/css">
    code.comment { display: none; }
  </style>
	<!-- Required Modernizr file -->
	<script src="deck.js/modernizr.custom.js"></script>

	<style type="text/css">
    .deck-container { font-size: 30px; } /* optimize the font display in 1366x768 computer */
    .slide ul, .slide ol { margin-bottom: 0 }
	</style>
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->

<section class="slide">
<h1>实践中的CI</h1>
</section>
<section class="slide">
<h2>自我介绍</h2>

<ul>
<li>李建业(淘宝花名：李福)
</li>
<li>2002年毕业后一直从事软件开发
</li>
<li>研发经历：办公自动化，电信网管、增值业务，互联网创业
</li>
<li>2009年底加入淘宝 广告应用开发
</li>
</ul>
</section>
<section class="slide">
<h2>背景</h2>

<ul>
<li class="slide">主要是应用系统，数据库操作居多
</li>
<li class="slide">架构逐渐趋向分布式、服务化
</li>
<li class="slide">研发水平参差不齐
</li>
</ul>
</section>
<section class="slide">
<h2>对持续集成的理解</h2>

<ul>
<li class="slide">真实环境中的验证工作
</li>
<li class="slide">彻底的自动化: 部署 + 测试
</li>
</ul>
</section>
<section class="slide">
<h2>遇到问题</h2>
<h4>自动化测试失败</h4>

<p><img src="./images/ut_failure.png" alt=""></p>
</section>
<section class="slide">
<h2>遇到问题</h2>

<p><img src="./images/ut_failure02.png" alt=""></p>
<pre class="slide">共用外部资源(数据库)，存在干扰
</pre>
</section>
<section class="slide">
<h2>遇到问题</h2>

<p><img src="./images/ut_failure03.png" alt=""></p>
<pre class="slide">分支间没有服务隔离(配置环境更复杂了)
</pre>
</section>
<section class="slide">
<h2>遇到问题</h2>
<h4 class="slide">联调基本靠手工，时间和人力成本很高</h4>
<pre class="slide">L项目，准备联调环境需要近一周  
</pre>
<h4 class="slide">系统依赖增多，对集成需求增加</h4>
<pre class="slide">日常项目可能涉及5、6个系统
</pre>
<h4 class="slide">重复使用旧环境，结果不确定</h4>
<pre class="slide">遗留jar包的陷阱...
</pre>
</section>
<section class="slide">
<h2>解决思路</h2>
<h4 class="slide">隔离、独立</h4>
<pre class="slide">独立数据库 + 干净的虚拟机构建
</pre>
<h4 class="slide">建立“真实”分布式环境</h4>
<pre class="slide">Mock成本
</pre>
<h4 class="slide">自动化部署</h4>
<pre class="slide">分布式环境，缩短验证和发布周期
</pre>
</section>
<section class="slide">
<h2>整体的方案</h2>

<p><img src="./images/green_arrow.png" alt=""></p>
</section>
<section class="slide">
<h2>整体的方案</h2>

<p><img src="./images/arch3.png" alt=""></p>
</section>
<section class="slide">
<h2>分工</h2>

<ul>
<li class="slide">研发工程师

<ul>
<li class="slide">根据系统设计编写和维护部署脚本
</li>
<li class="slide">编写配置文件描述系统
<pre>
# ceres.rb
app<em>server :tomcat
source :svn =&gt; &#39;http://svn....com/.../trunk/&#39;
use :hsf
vm &quot;hsf</em>service_6.0&quot;
use :toast
after :mercury
</pre>
</li>
</ul>
</li>
</ul>
</section>
<section class="slide">
<h2>分工</h2>

<ul>
<li class="slide">测试工程师

<ul>
<li class="slide">初期与线上PE协作参与部署脚本的编写
</li>
<li class="slide">维护联调测试用例
</li>
</ul>
</li>
</ul>
</section>
<section class="slide">
<h2>困难</h2>
<h3 class="slide">处理大量数据</h3>
<pre class="slide">直接数据clone
</pre>
<h3 class="slide">脚本 vs. 镜像模板</h3>
<pre class="slide">使用pp脚本，避免过度利用虚拟机镜像
</pre>
</section>
<section class="slide">
<h2>困难-中间件</h2>

<p><img src="./images/middleware.png" alt=""></p>
<h5 class="slide">推动中间件的自动化部署!</h5>
</section>
<section class="slide">
<h2>困难-中间件</h2>

<p><img src="./images/middleware01.png" alt="">
<img src="./images/middleware02.png" alt=""></p>
<h5 class="slide">workaround!</h5>
</section>
<section class="slide">
<h2>困难-配置项统一管理</h2>

<ul>
<li class="slide">现状：数据库脚本由DBA负责

<ul>
<li class="slide">以CI的名义：团队维护数据库建构和初始化脚本
</li>
</ul>
</li>
<li class="slide">现状：系统配置信息分散在运维系统和研发系统的数据库中

<ul>
<li class="slide">输出pp文件
</li>
<li class="slide">构建系统统一推送
</li>
<li class="slide">本地执行
</li>
<li class="slide">我们还在尝试......
</li>
</ul>
</li>
</ul>
</section>
<section class="slide">
<h2>目前的结果</h2>

<ul>
<li class="slide">Q项目

<ul>
<li class="slide">联调环境(多应用): 构建自动化，5分钟完成构建和测试
</li>
<li class="slide">遇到不知名的原因导致联调环境出现错误，直接重建
</li>
</ul>
</li>
<li class="slide">U项目

<ul>
<li class="slide">发现了遗留jar包的陷阱
</li>
</ul>
</li>
</ul>
</section>
<section class="slide">
<h2>总结一下</h2>
<h3>两个重点</h3>

<ul>
<li class="slide">构建干净的环境
:云技术
</li>
<li class="slide">单一应用到分布式
:自动化大集成
</li>
</ul>
<h3>一个干扰</h3>
<pre class="slide">传统的分工: DBA, PE, QA
</pre>
</section>
<section class="slide">
<h2>心得</h2>

<p><img src="./images/software_layer.png" alt=""></p>
<pre class="slide">TDD vs. BDD
</pre>
</section>
<section class="slide">
<h2>愿景</h2>

<p><img src="./images/arch2.png" alt=""></p>
</section>
<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="deck.js/jquery-1.7.2.min.js"></script>
<script src="deck.js/core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="deck.js/core/deck.core.js"></script>
<script src="deck.js/extensions/hash/deck.hash.js"></script>
<script src="deck.js/extensions/menu/deck.menu.js"></script>
<script src="deck.js/extensions/goto/deck.goto.js"></script>
<script src="deck.js/extensions/status/deck.status.js"></script>
<script src="deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="deck.js/extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
  $(function() {
    $.deck('.slide');
    $(document).keydown(function(e){
      if (e.keyCode == 80) { //press 'p': comments tanggle
        if($("code.comment").css("display")=="none"){
          $("code.comment").css("display","block");
        }else{
          $("code.comment").css("display","none");
        }
        return false;
      } else if (e.keyCode == 81){//press 'q': open 'all' page with comments
        window.open("all.html");
      }
    });
    window.addEventListener('message', receiver, false);
    function receiver (event) {
      var data = event.data;
      if(data instanceof Object){
        switch(data['method']){
          case "go": {
            $.deck('go', data['index'] || 0);
          }
          default: {}
        }
      }
    };

  });

  function go_to(index){
    $.deck('go',index);
  }

  if(opener){
    $(document).bind('deck.change', function(event, from, to) {
        opener.postMessage({'method':'go','index':to},'*');
      }
    );
  }
</script>
</body>
</html>
